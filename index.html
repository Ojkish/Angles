<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angles</title>
    <style>
        :root {
            --bg-color: #050505;
            --panel-color: #111;
            --accent-color: #f1c40f;
            --danger-color: #e74c3c;
        }

        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            background: var(--bg-color); 
            color: #eee; 
            margin: 0; 
            display: flex; 
            height: 100vh; 
            flex-direction: row; /* Défaut : Desktop */
            overflow: hidden; 
        }

        /* Responsive : Empilement sur petits écrans */
        @media (max-width: 768px) {
            body { flex-direction: column; overflow-y: auto; }
            .sidebar { width: 100% !important; border-right: none !important; border-bottom: 1px solid #333; order: 2; }
            .view { height: 45vh; order: 1; flex-shrink: 0; }
        }

        .sidebar { 
            width: 320px; 
            background: var(--panel-color); 
            padding: 15px; 
            border-right: 1px solid #333; 
            display: flex; 
            flex-direction: column; 
            gap: 12px; 
            box-sizing: border-box;
        }

        .view { flex-grow: 1; background: #000; position: relative; min-height: 200px; }
        canvas { width: 100%; height: 100%; display: block; }

        .input-group { background: #1a1a1a; padding: 10px; border-radius: 8px; }
        label { display: block; font-size: 0.75em; color: #888; margin-bottom: 5px; text-transform: uppercase; font-weight: bold; }
        
        .flex-input { display: flex; gap: 10px; align-items: center; }
        input[type="range"] { flex-grow: 1; accent-color: var(--accent-color); }
        input[type="number"] { width: 50px; background: #222; border: 1px solid #444; color: #fff; padding: 4px; border-radius: 4px; }

        .results { 
            background: var(--accent-color); 
            color: #000; 
            padding: 12px; 
            border-radius: 8px; 
            font-weight: bold; 
            margin-top: auto; 
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        .results.infinite { background: var(--danger-color); color: #fff; }
        .results p { margin: 5px 0; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="input-group">
        <label>Ouverture α (°)</label>
        <div class="flex-input">
            <input type="range" id="alphaRange" min="2" max="120" value="40">
            <input type="number" id="alphaNum" value="40">
        </div>
    </div>
    <div class="input-group">
        <label>Hauteur h (m)</label>
        <div class="flex-input">
            <input type="range" id="hRange" min="1" max="20" step="0.1" value="7">
            <input type="number" id="hNum" value="7">
        </div>
    </div>
    <div class="input-group">
        <label>Inclinaison (Tilt °)</label>
        <div class="flex-input">
            <input type="range" id="tiltRange" min="-80" max="80" value="30">
            <input type="number" id="tiltNum" value="30">
        </div>
    </div>
    <div id="resPanel" class="results">
        <p>Largeur au sol : <span id="resDiam">--</span></p>
        <p>Décalage (d) : <span id="resDecal">--</span></p>
    </div>
</div>

<div class="view">
    <canvas id="canvas"></canvas>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const resPanel = document.getElementById('resPanel');

    const ui = {
        alpha: document.getElementById('alphaNum'),
        h: document.getElementById('hNum'),
        tilt: document.getElementById('tiltNum')
    };

    // Liaison bidirectionnelle des inputs
    document.querySelectorAll('input').forEach(input => {
        input.oninput = (e) => {
            const id = e.target.id.replace('Range', '').replace('Num', '');
            document.getElementById(id+'Range').value = e.target.value;
            document.getElementById(id+'Num').value = e.target.value;
            update();
        };
    });

    // Redessiner si la fenêtre change de taille (rotation mobile)
    window.onresize = update;

    function update() {
        const a = parseFloat(ui.alpha.value), h = parseFloat(ui.h.value), t = parseFloat(ui.tilt.value);
        const aRad = a * Math.PI / 180, tRad = t * Math.PI / 180;

        const angleGauche = tRad - aRad/2;
        const angleDroit = tRad + aRad/2;

        let x1, x2;
        let isInfinite = (angleGauche <= -Math.PI / 2 || angleDroit >= Math.PI / 2);
        
        // Calculs des positions au sol
        x1 = (angleGauche <= -Math.PI / 2) ? 5000 : -h * Math.tan(angleGauche);
        x2 = (angleDroit >= Math.PI / 2) ? -5000 : -h * Math.tan(angleDroit);

        // Mise à jour de l'affichage texte
        const displayDiam = isInfinite ? "∞" : Math.abs(x2 - x1).toFixed(2) + " m";
        const displayDecal = (angleGauche <= -Math.PI / 2) ? "∞" : (-x1).toFixed(2) + " m";

        document.getElementById('resDiam').innerText = displayDiam;
        document.getElementById('resDecal').innerText = displayDecal;

        if (isInfinite) resPanel.classList.add('infinite');
        else resPanel.classList.remove('infinite');

        draw(h, tRad, x1, x2, isInfinite);
    }   

    function draw(h, tRad, x1, x2, isInfinite) {
        canvas.width = canvas.clientWidth; 
        canvas.height = canvas.clientHeight;
        
        // Echelle adaptative : on s'adapte à la largeur du canvas (important sur mobile vertical)
        const scale = Math.min(canvas.width / 25, canvas.height / (h + 4));
        const offsetX = canvas.width / 2;
        const groundY = canvas.height - 40;
        const startY = groundY - (h * scale);

        ctx.clearRect(0,0, canvas.width, canvas.height);

        // 1. SOL
        ctx.strokeStyle = "#444"; ctx.lineWidth = 1;
        ctx.beginPath(); ctx.moveTo(0, groundY); ctx.lineTo(canvas.width, groundY); ctx.stroke();

        // 2. FAISCEAU
        ctx.fillStyle = isInfinite ? "rgba(231, 76, 60, 0.4)" : "rgba(241, 196, 15, 0.35)";
        ctx.beginPath();
        ctx.moveTo(offsetX, startY); 
        ctx.lineTo(offsetX + (x1 * scale), groundY); 
        ctx.lineTo(offsetX + (x2 * scale), groundY); 
        ctx.closePath();
        ctx.fill();

        // 3. PROJECTEUR
        ctx.save();
        ctx.translate(offsetX, startY);
        ctx.rotate(tRad);
        ctx.fillStyle = "#333";
        ctx.fillRect(-12, -35, 24, 35); 
        ctx.fillStyle = isInfinite ? "#e74c3c" : "#f1c40f";
        ctx.fillRect(-12, -2, 24, 4); 
        ctx.restore();

        // 4. INFOS HAUTEUR
        ctx.fillStyle = "#888";
        ctx.font = "12px sans-serif";
        ctx.textAlign = "right";
        ctx.fillText(h + "m", offsetX - 10, (startY + groundY) / 2);
    }

    update();
</script>
</body>
</html>
